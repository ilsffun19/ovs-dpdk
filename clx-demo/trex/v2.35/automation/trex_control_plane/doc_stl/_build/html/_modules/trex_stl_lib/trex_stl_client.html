<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>trex_stl_lib.trex_stl_client &mdash; TRex Stateless Python API 1.7.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/no_scrollbars.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="TRex Stateless Python API 1.7.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TRex Stateless Python API 1.7.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for trex_stl_lib.trex_stl_client</h1><div class="highlight"><pre>
<span class="c">#!/router/bin/python</span>

<span class="c"># for API usage the path name must be full</span>
<span class="kn">from</span> <span class="nn">trex_stl_lib.trex_stl_exceptions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">trex_stl_lib.trex_stl_streams</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">trex_stl_jsonrpc_client</span> <span class="kn">import</span> <span class="n">JsonRpcClient</span><span class="p">,</span> <span class="n">BatchMessage</span>
<span class="kn">import</span> <span class="nn">trex_stl_stats</span>

<span class="kn">from</span> <span class="nn">trex_stl_port</span> <span class="kn">import</span> <span class="n">Port</span>
<span class="kn">from</span> <span class="nn">trex_stl_types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">trex_stl_async_client</span> <span class="kn">import</span> <span class="n">CTRexAsyncClient</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">parsing_opts</span><span class="p">,</span> <span class="n">text_tables</span><span class="p">,</span> <span class="n">common</span>
<span class="kn">from</span> <span class="nn">utils.text_opts</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">yaml</span> <span class="kn">import</span> <span class="n">YAMLError</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="c">############################     logger     #############################</span>
<span class="c">############################                #############################</span>
<span class="c">############################                #############################</span>

<span class="c"># logger API for the client</span>
<span class="k">class</span> <span class="nc">LoggerApi</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c"># verbose levels</span>
    <span class="n">VERBOSE_QUIET</span>   <span class="o">=</span> <span class="mi">0</span>
    <span class="n">VERBOSE_REGULAR</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">VERBOSE_HIGH</span>    <span class="o">=</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">LoggerApi</span><span class="o">.</span><span class="n">VERBOSE_REGULAR</span>

    <span class="c"># implemented by specific logger</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">newline</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;implement this&quot;</span><span class="p">)</span>

    <span class="c"># implemented by specific logger</span>
    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;implement this&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_verbose</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VERBOSE_QUIET</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERBOSE_HIGH</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;bad value provided for logger&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

    <span class="k">def</span> <span class="nf">get_verbose</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span>


    <span class="k">def</span> <span class="nf">check_verbose</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">&gt;=</span> <span class="n">level</span><span class="p">)</span>


    <span class="c"># simple log message with verbose</span>
    <span class="k">def</span> <span class="nf">log</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">VERBOSE_REGULAR</span><span class="p">,</span> <span class="n">newline</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_verbose</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>

    <span class="c"># logging that comes from async event</span>
    <span class="k">def</span> <span class="nf">async_log</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">level</span> <span class="o">=</span> <span class="n">VERBOSE_REGULAR</span><span class="p">,</span> <span class="n">newline</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">pre_cmd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">{:&lt;60}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">desc</span><span class="p">),</span> <span class="s">&#39;bold&#39;</span><span class="p">),</span> <span class="n">newline</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">post_cmd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;[SUCCESS]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;[FAILED]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">log_cmd</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desc</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>


    <span class="c"># supress object getter</span>
    <span class="k">def</span> <span class="nf">supress</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">Supress</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>

            <span class="k">def</span> <span class="nf">__enter__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saved_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">get_verbose</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">set_verbose</span><span class="p">(</span><span class="n">LoggerApi</span><span class="o">.</span><span class="n">VERBOSE_QUIET</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">__exit__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">set_verbose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saved_level</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Supress</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>



<span class="c"># default logger - to stdout</span>
<span class="k">class</span> <span class="nc">DefaultLogger</span><span class="p">(</span><span class="n">LoggerApi</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DefaultLogger</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">newline</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">newline</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">msg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">msg</span><span class="p">,</span>

    <span class="k">def</span> <span class="nf">flush</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>


<span class="c">############################     async event hander     #############################</span>
<span class="c">############################                            #############################</span>
<span class="c">############################                            #############################</span>

<span class="c"># handles different async events given to the client</span>
<span class="k">class</span> <span class="nc">AsyncEventHandler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">logger</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c"># public functions</span>

    <span class="k">def</span> <span class="nf">get_events</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">events</span>


    <span class="k">def</span> <span class="nf">clear_events</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="k">def</span> <span class="nf">on_async_dead</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connected</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;lost connection to server&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__add_event_log</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;local&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">on_async_alive</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">handle_async_rx_stats_event</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">baseline</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">flow_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>


    <span class="c"># handles an async stats update from the subscriber</span>
    <span class="k">def</span> <span class="nf">handle_async_stats_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump_data</span><span class="p">,</span> <span class="n">baseline</span><span class="p">):</span>
        <span class="n">global_stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">port_stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># filter the values per port and general</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dump_data</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c"># match a pattern of ports</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;(.*)\-(\d+)&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
                <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">port_id</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_stats</span><span class="p">:</span>
                        <span class="n">port_stats</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">port_stats</span><span class="p">[</span><span class="n">port_id</span><span class="p">][</span><span class="n">field_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># no port match - general stats</span>
                <span class="n">global_stats</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c"># update the general object with the snapshot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">global_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">global_stats</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>

        <span class="c"># update all ports</span>
        <span class="k">for</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">port_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">port_stats</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">baseline</span><span class="p">)</span>


    <span class="c"># dispatcher for server async events (port started, port stopped and etc.)</span>
    <span class="k">def</span> <span class="nf">handle_async_event</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c"># DP stopped</span>
        <span class="n">show_event</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># port started</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;port_id&#39;</span><span class="p">])</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Port {0} has started&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_port_started</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

        <span class="c"># port stopped</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;port_id&#39;</span><span class="p">])</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Port {0} has stopped&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

            <span class="c"># call the handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_port_stopped</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>


        <span class="c"># port paused</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;port_id&#39;</span><span class="p">])</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Port {0} has paused&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

            <span class="c"># call the handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_port_paused</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

        <span class="c"># port resumed</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;port_id&#39;</span><span class="p">])</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Port {0} has resumed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

            <span class="c"># call the handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_port_resumed</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

        <span class="c"># port finished traffic</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;port_id&#39;</span><span class="p">])</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Port {0} job done&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>

            <span class="c"># call the handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_port_job_done</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>
            <span class="n">show_event</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># port was stolen...</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">session_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;session_id&#39;</span><span class="p">]</span>

            <span class="c"># false alarm, its us</span>
            <span class="k">if</span> <span class="n">session_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">session_id</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">port_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;port_id&#39;</span><span class="p">])</span>
            <span class="n">who</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;who&#39;</span><span class="p">]</span>

            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Port {0} was forcely taken by &#39;{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="n">who</span><span class="p">)</span>

            <span class="c"># call the handler</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_port_forced_acquired</span><span class="p">(</span><span class="n">port_id</span><span class="p">)</span>
            <span class="n">show_event</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="c"># server stopped</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">type</span> <span class="o">==</span> <span class="mi">100</span><span class="p">):</span>
            <span class="n">ev</span> <span class="o">=</span> <span class="s">&quot;Server has stopped&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__async_event_server_stopped</span><span class="p">()</span>
            <span class="n">show_event</span> <span class="o">=</span> <span class="bp">True</span>


        <span class="k">else</span><span class="p">:</span>
            <span class="c"># unknown event - ignore</span>
            <span class="k">return</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">__add_event_log</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span> <span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="n">show_event</span><span class="p">)</span>


    <span class="c"># private functions</span>

    <span class="k">def</span> <span class="nf">__async_event_port_job_done</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">async_event_port_job_done</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__async_event_port_stopped</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">async_event_port_stopped</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__async_event_port_started</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">async_event_port_started</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__async_event_port_paused</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">async_event_port_paused</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__async_event_port_resumed</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">async_event_port_resumed</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__async_event_port_forced_acquired</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">async_event_forced_acquired</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__async_event_server_stopped</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">False</span>


    <span class="c"># add event to log</span>
    <span class="k">def</span> <span class="nf">__add_event_log</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">ev_type</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">ev_type</span> <span class="o">==</span> <span class="s">&quot;server&quot;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;[server]&quot;</span>
        <span class="k">elif</span> <span class="n">ev_type</span> <span class="o">==</span> <span class="s">&quot;local&quot;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;[local]&quot;</span>

        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;{:&lt;10} - {:^8} - {:}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">format_text</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">async_log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">{:^8} - {:}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">format_text</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))))</span>


  


<span class="c">############################     RPC layer     #############################</span>
<span class="c">############################                   #############################</span>
<span class="c">############################                   #############################</span>

<span class="k">class</span> <span class="nc">CCommLink</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;describes the connectivity of the stateless client method&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5050</span><span class="p">,</span> <span class="n">virtual</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">prn_func</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">virtual</span> <span class="o">=</span> <span class="n">virtual</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span> <span class="o">=</span> <span class="n">JsonRpcClient</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">prn_func</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_connected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">connected</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">get_server</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span>

    <span class="k">def</span> <span class="nf">get_port</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">transmit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prompt_virtual_tx_msg</span><span class="p">()</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">create_jsonrpc_v2</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="k">print</span> <span class="n">msg</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">invoke_rpc_method</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transmit_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtual</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prompt_virtual_tx_msg</span><span class="p">()</span>
            <span class="k">print</span> <span class="p">[</span><span class="n">msg</span>
                   <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">create_jsonrpc_v2</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
                                  <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">batch_list</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_link</span><span class="o">.</span><span class="n">create_batch</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">batch_list</span><span class="p">:</span>
                <span class="n">batch</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
            <span class="c"># invoke the batch</span>
            <span class="k">return</span> <span class="n">batch</span><span class="o">.</span><span class="n">invoke</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_prompt_virtual_tx_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;Transmitting virtually over tcp://{server}:{port}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span>
                                                                         <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>



<span class="c">############################     client     #############################</span>
<span class="c">############################                #############################</span>
<span class="c">############################                #############################</span>

<div class="viewcode-block" id="STLClient"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient">[docs]</a><span class="k">class</span> <span class="nc">STLClient</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;TRex Stateless client object- gives operations per TRex/user&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">username</span> <span class="o">=</span> <span class="n">common</span><span class="o">.</span><span class="n">get_current_user</span><span class="p">(),</span>
                 <span class="n">server</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span>
                 <span class="n">sync_port</span> <span class="o">=</span> <span class="mi">4501</span><span class="p">,</span>
                 <span class="n">async_port</span> <span class="o">=</span> <span class="mi">4500</span><span class="p">,</span>
                 <span class="n">verbose_level</span> <span class="o">=</span> <span class="n">LoggerApi</span><span class="o">.</span><span class="n">VERBOSE_QUIET</span><span class="p">,</span>
                 <span class="n">logger</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                 <span class="n">virtual</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Set the connection setting </span>

<span class="sd">        :parameters:</span>
<span class="sd">             username : string </span>
<span class="sd">                the user name, for example imarom</span>

<span class="sd">              server  : string </span>
<span class="sd">                the server name or ip </span>

<span class="sd">              sync_port : int </span>
<span class="sd">                the RPC port </span>

<span class="sd">              async_port : int </span>
<span class="sd">                the ASYNC port </span>

<span class="sd">        .. code-block:: python</span>
<span class="sd">            :caption: Example</span>


<span class="sd">            # connect to local TRex server </span>
<span class="sd">            c = STLClient()</span>

<span class="sd">            # connect to remote server trex-remote-server</span>
<span class="sd">            c = STLClient(server = &quot;trex-remote-server&quot; )</span>

<span class="sd">            c = STLClient(server = &quot;10.0.0.10&quot; )</span>

<span class="sd">            # verbose mode </span>
<span class="sd">            c = STLClient(server = &quot;10.0.0.10&quot;, verbose_level = LoggerApi.VERBOSE_HIGH )</span>
<span class="sd">            </span>
<span class="sd">            # change user name </span>
<span class="sd">            c = STLClient(username = &quot;root&quot;,server = &quot;10.0.0.10&quot;, verbose_level = LoggerApi.VERBOSE_HIGH )</span>

<span class="sd">            c.connect()</span>

<span class="sd">            c.disconnect()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">username</span>   <span class="o">=</span> <span class="n">username</span>
         
        <span class="c"># init objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">DefaultLogger</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">logger</span> <span class="k">else</span> <span class="n">logger</span>

        <span class="c"># initial verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">set_verbose</span><span class="p">(</span><span class="n">verbose_level</span><span class="p">)</span>

        <span class="c"># low level RPC layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span> <span class="o">=</span> <span class="n">CCommLink</span><span class="p">(</span><span class="n">server</span><span class="p">,</span>
                                   <span class="n">sync_port</span><span class="p">,</span>
                                   <span class="n">virtual</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>

        <span class="c"># async event handler manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_handler</span> <span class="o">=</span> <span class="n">AsyncEventHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># async subscriber level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_client</span> <span class="o">=</span> <span class="n">CTRexAsyncClient</span><span class="p">(</span><span class="n">server</span><span class="p">,</span>
                                             <span class="n">async_port</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="p">)</span>

        
      

        <span class="c"># stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;username&quot;</span><span class="p">:</span>   <span class="n">username</span><span class="p">,</span>
                                <span class="s">&quot;server&quot;</span><span class="p">:</span>     <span class="n">server</span><span class="p">,</span>
                                <span class="s">&quot;sync_port&quot;</span><span class="p">:</span>  <span class="n">sync_port</span><span class="p">,</span>
                                <span class="s">&quot;async_port&quot;</span><span class="p">:</span> <span class="n">async_port</span><span class="p">,</span>
                                <span class="s">&quot;virtual&quot;</span><span class="p">:</span>    <span class="n">virtual</span><span class="p">}</span>

        
        <span class="bp">self</span><span class="o">.</span><span class="n">global_stats</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">CGlobalStats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">,</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flow_stats</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">CRxStats</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stats_generator</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">CTRexInfoGenerator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_stats</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">flow_stats</span><span class="p">)</span>


 
    <span class="c">############# private functions - used by the class itself ###########</span>

    <span class="c"># some preprocessing for port argument</span>
    <span class="k">def</span> <span class="nf">__ports</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">):</span>

        <span class="c"># none means all</span>
        <span class="k">if</span> <span class="n">port_id_list</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_port_count</span><span class="p">())</span>

        <span class="c"># always list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">port_id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">port_id_list</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;bad port id list: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">port_id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">port_id</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_port_count</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;bad port id {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">port_id_list</span>


    <span class="c"># sync ports</span>
    <span class="k">def</span> <span class="nf">__sync_ports</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">sync</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">rc</span>

    <span class="c"># acquire ports, if port_list is none - get all</span>
    <span class="k">def</span> <span class="nf">__acquire</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">force</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>

    <span class="c"># release ports</span>
    <span class="k">def</span> <span class="nf">__release</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">release</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__add_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_list</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">add_streams</span><span class="p">(</span><span class="n">stream_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>



    <span class="k">def</span> <span class="nf">__remove_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id_list</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove_streams</span><span class="p">(</span><span class="n">stream_id_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>



    <span class="k">def</span> <span class="nf">__remove_all_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">remove_all_streams</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__get_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">get_pkt</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_stream</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__get_all_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">get_pkt</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_all_streams</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__get_stream_id_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_stream_id_list</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">__start</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__resume</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">resume</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">rc</span>

    <span class="k">def</span> <span class="nf">__pause</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">pause</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__stop</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">force</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__update</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__validate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">validate</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="k">def</span> <span class="nf">__set_port_attr</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">attr_dict</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="n">port_id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ports</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">)</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">RC</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">rc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_attr</span><span class="p">(</span><span class="n">attr_dict</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">rc</span>


    <span class="c"># connect to server</span>
    <span class="k">def</span> <span class="nf">__connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># first disconnect if already connected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__disconnect</span><span class="p">()</span>

        <span class="c"># clear this flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># connect sync channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Connecting to RPC server on {0}:{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;server&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;sync_port&#39;</span><span class="p">]))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>

        <span class="c"># version</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transmit</span><span class="p">(</span><span class="s">&quot;get_version&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_stats</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

        <span class="c"># cache system info</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transmit</span><span class="p">(</span><span class="s">&quot;get_system_info&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

        <span class="c"># cache supported commands</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transmit</span><span class="p">(</span><span class="s">&quot;get_supported_cmds&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supported_cmds</span> <span class="o">=</span> <span class="n">rc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

        <span class="c"># create ports</span>
        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s">&quot;port_count&quot;</span><span class="p">]):</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span><span class="p">[</span><span class="s">&#39;ports&#39;</span><span class="p">][</span><span class="n">port_id</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">Port</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">,</span>
                                       <span class="n">info</span><span class="p">)</span>


        <span class="c"># sync the ports</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sync_ports</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>

        
        <span class="c"># connect async channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;connecting to publisher server on {0}:{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;server&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;async_port&#39;</span><span class="p">]))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_client</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">RC_OK</span><span class="p">()</span>


    <span class="c"># disconenct from server</span>
    <span class="k">def</span> <span class="nf">__disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">release_ports</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="c"># release any previous acquired ports</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span> <span class="ow">and</span> <span class="n">release_ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__release</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">async_client</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="n">RC_OK</span><span class="p">()</span>


    <span class="c"># clear stats</span>
    <span class="k">def</span> <span class="nf">__clear_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">,</span> <span class="n">clear_global</span><span class="p">,</span> <span class="n">clear_flow_stats</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">clear_global</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_stats</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">clear_flow_stats</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flow_stats</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log_cmd</span><span class="p">(</span><span class="s">&quot;clearing stats on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">RC</span>


    <span class="c"># get stats</span>
    <span class="k">def</span> <span class="nf">__get_stats</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">):</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">stats</span><span class="p">[</span><span class="s">&#39;global&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_stats</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>

        <span class="n">total</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="n">port_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
            <span class="n">stats</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_stats</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">port_stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">total</span><span class="p">:</span>
                    <span class="n">total</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">total</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span>

        <span class="n">stats</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>

        <span class="n">stats</span><span class="p">[</span><span class="s">&#39;flow_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_stats</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">stats</span>


    <span class="c">############ functions used by other classes but not users ##############</span>

    <span class="k">def</span> <span class="nf">_validate_port_list</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">):</span>
        <span class="c"># listfiy single int</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">port_id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">port_id_list</span><span class="p">]</span>

        <span class="c"># should be a list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">STLTypeError</span><span class="p">(</span><span class="s">&#39;port_id_list&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">),</span> <span class="nb">list</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="s">&#39;No ports provided&#39;</span><span class="p">)</span>

        <span class="n">valid_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">valid_ports</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="s">&quot;Port ID &#39;{0}&#39; is not a valid port ID - valid values: {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="n">valid_ports</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">port_id_list</span>


    <span class="c"># transmit request on the RPC link</span>
    <span class="k">def</span> <span class="nf">_transmit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span><span class="o">.</span><span class="n">transmit</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="c"># transmit batch request on the RPC link</span>
    <span class="k">def</span> <span class="nf">_transmit_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch_list</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span><span class="o">.</span><span class="n">transmit_batch</span><span class="p">(</span><span class="n">batch_list</span><span class="p">)</span>

    <span class="c"># stats</span>
    <span class="k">def</span> <span class="nf">_get_formatted_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">,</span> <span class="n">stats_mask</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">COMPACT</span><span class="p">):</span>
        <span class="n">stats_opts</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">ALL_STATS_OPTS</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">stats_mask</span><span class="p">)</span>

        <span class="n">stats_obj</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stats_type</span> <span class="ow">in</span> <span class="n">stats_opts</span><span class="p">:</span>
            <span class="n">stats_obj</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_generator</span><span class="o">.</span><span class="n">generate_single_statistic</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">,</span> <span class="n">stats_type</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">stats_obj</span>

    <span class="k">def</span> <span class="nf">_get_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">,</span> <span class="n">streams_mask</span><span class="o">=</span><span class="nb">set</span><span class="p">()):</span>

        <span class="n">streams_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_generator</span><span class="o">.</span><span class="n">generate_streams_info</span><span class="p">(</span><span class="n">port_id_list</span><span class="p">,</span> <span class="n">streams_mask</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">streams_obj</span>


    <span class="k">def</span> <span class="nf">_invalidate_stats</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">port_id_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">invalidate_stats</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">global_stats</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_stats</span><span class="o">.</span><span class="n">invalidate</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">RC_OK</span><span class="p">()</span>


 
 

    <span class="c">#################################</span>
    <span class="c"># ------ private methods ------ #</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__get_mask_keys</span><span class="p">(</span><span class="n">ok_values</span><span class="o">=</span><span class="p">{</span><span class="bp">True</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">masked_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ok_values</span><span class="p">:</span>
                <span class="n">masked_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">masked_keys</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__filter_namespace_args</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">ok_values</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">namespace</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ok_values</span><span class="p">}</span>


    <span class="c"># API decorator - double wrap because of argument</span>
    <span class="k">def</span> <span class="nf">__api_check</span><span class="p">(</span><span class="n">connected</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">wrap</span> <span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">wrap2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">client</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">func_name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">__name__</span>

                <span class="c"># check connection</span>
                <span class="k">if</span> <span class="n">connected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">client</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">STLStateError</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="s">&#39;disconnected&#39;</span><span class="p">)</span>

                <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">ret</span>
            <span class="k">return</span> <span class="n">wrap2</span>

        <span class="k">return</span> <span class="n">wrap</span>



    <span class="c">############################     API     #############################</span>
    <span class="c">############################             #############################</span>
    <span class="c">############################             #############################</span>
    <span class="k">def</span> <span class="nf">__enter__</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">force</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="c">############################   Getters   #############################</span>
    <span class="c">############################             #############################</span>
    <span class="c">############################             #############################</span>


    <span class="c"># return verbose level of the logger</span>
<div class="viewcode-block" id="STLClient.get_verbose"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">get_verbose</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        get the verbose mode  </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            get the verbose mode as Bool</span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">get_verbose</span><span class="p">()</span>

    <span class="c"># is the client on read only mode ?</span></div>
<div class="viewcode-block" id="STLClient.is_all_ports_acquired"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.is_all_ports_acquired">[docs]</a>    <span class="k">def</span> <span class="nf">is_all_ports_acquired</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">         is_all_ports_acquired</span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            return  True if all ports are acquired</span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">())</span>

    <span class="c"># is the client connected ?</span></div>
<div class="viewcode-block" id="STLClient.is_connected"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.is_connected">[docs]</a>    <span class="k">def</span> <span class="nf">is_connected</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            is_connected</span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm_link</span><span class="o">.</span><span class="n">is_connected</span>


    <span class="c"># get connection info</span></div>
<div class="viewcode-block" id="STLClient.get_connection_info"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_connection_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_connection_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            connection dict </span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span>


    <span class="c"># get supported commands by the server</span></div>
<div class="viewcode-block" id="STLClient.get_server_supported_cmds"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_server_supported_cmds">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_supported_cmds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            connection dict </span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">supported_cmds</span>

    <span class="c"># get server version</span></div>
<div class="viewcode-block" id="STLClient.get_server_version"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_server_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            connection dict </span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span>

    <span class="c"># get server system info</span></div>
<div class="viewcode-block" id="STLClient.get_server_system_info"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_server_system_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            connection dict </span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_info</span>

    <span class="c"># get port count</span></div>
<div class="viewcode-block" id="STLClient.get_port_count"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_port_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_port_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            connection dict </span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>


    <span class="c"># returns the port object</span></div>
    <span class="k">def</span> <span class="nf">get_port</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_id</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">port_id</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">port</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">port</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;port id&#39;</span><span class="p">,</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">valid_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">())</span>


    <span class="c"># get all ports as IDs</span>
<div class="viewcode-block" id="STLClient.get_all_ports"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_all_ports">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_ports</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>

<span class="sd">        :parameters:</span>
<span class="sd">          none</span>

<span class="sd">        :return:</span>
<span class="sd">            connection dict </span>

<span class="sd">        :raises:</span>
<span class="sd">          None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="c"># get all acquired ports</span></div>
    <span class="k">def</span> <span class="nf">get_acquired_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">port_id</span>
                <span class="k">for</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">port_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">port_obj</span><span class="o">.</span><span class="n">is_acquired</span><span class="p">()]</span>

    <span class="c"># get all active ports (TX or pause)</span>
    <span class="k">def</span> <span class="nf">get_active_ports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">port_id</span>
                <span class="k">for</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">port_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">port_obj</span><span class="o">.</span><span class="n">is_active</span><span class="p">()]</span>

    <span class="c"># get paused ports</span>
    <span class="k">def</span> <span class="nf">get_paused_ports</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">port_id</span>
                <span class="k">for</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">port_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">port_obj</span><span class="o">.</span><span class="n">is_paused</span><span class="p">()]</span>

    <span class="c"># get all TX ports</span>
    <span class="k">def</span> <span class="nf">get_transmitting_ports</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">port_id</span>
                <span class="k">for</span> <span class="n">port_id</span><span class="p">,</span> <span class="n">port_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">port_obj</span><span class="o">.</span><span class="n">is_transmitting</span><span class="p">()]</span>


    <span class="c"># get stats</span>
    <span class="k">def</span> <span class="nf">get_stats</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">async_barrier</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="c"># by default use all acquired ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># check async barrier</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">async_barrier</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;async_barrier&#39;</span><span class="p">,</span> <span class="n">async_barrier</span><span class="p">)</span>


        <span class="c"># if the user requested a barrier - use it</span>
        <span class="k">if</span> <span class="n">async_barrier</span><span class="p">:</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">async_client</span><span class="o">.</span><span class="n">barrier</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_stats</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

    <span class="c"># return all async events</span>
    <span class="k">def</span> <span class="nf">get_events</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_handler</span><span class="o">.</span><span class="n">get_events</span><span class="p">()</span>

    <span class="c"># get port(s) info as a list of dicts</span>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_port_info</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_id</span><span class="p">]</span><span class="o">.</span><span class="n">get_info</span><span class="p">()</span> <span class="k">for</span> <span class="n">port_id</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">]</span>


    <span class="c">############################   Commands   #############################</span>
    <span class="c">############################              #############################</span>
    <span class="c">############################              #############################</span>


<div class="viewcode-block" id="STLClient.set_verbose"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.set_verbose">[docs]</a>    <span class="k">def</span> <span class="nf">set_verbose</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Sets verbose level</span>

<span class="sd">            :parameters:</span>
<span class="sd">                level : str</span>
<span class="sd">                    &quot;high&quot;</span>
<span class="sd">                    &quot;low&quot;</span>
<span class="sd">                    &quot;normal&quot;</span>

<span class="sd">            :raises:</span>
<span class="sd">                None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;low&#39;</span> <span class="p">:</span> <span class="n">LoggerApi</span><span class="o">.</span><span class="n">VERBOSE_QUIET</span><span class="p">,</span> <span class="s">&#39;normal&#39;</span><span class="p">:</span> <span class="n">LoggerApi</span><span class="o">.</span><span class="n">VERBOSE_REGULAR</span><span class="p">,</span> <span class="s">&#39;high&#39;</span><span class="p">:</span> <span class="n">LoggerApi</span><span class="o">.</span><span class="n">VERBOSE_HIGH</span><span class="p">}</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">modes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;level&#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">set_verbose</span><span class="p">(</span><span class="n">modes</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.connect"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        def connect(self):</span>

<span class="sd">            Connects to the TRex server</span>

<span class="sd">            :parameters:</span>
<span class="sd">                None</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__connect</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
        
</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.disconnect"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_traffic</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">release_ports</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Disconnects from the server</span>

<span class="sd">            :parameters:</span>
<span class="sd">                stop_traffic : bool</span>
<span class="sd">                    tries to stop traffic before disconnecting</span>
<span class="sd">                release_ports : bool</span>
<span class="sd">                    tries to release all the acquired ports</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># try to stop ports but do nothing if not possible</span>
        <span class="k">if</span> <span class="n">stop_traffic</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">STLError</span><span class="p">:</span>
                <span class="k">pass</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Disconnecting from server at &#39;{0}&#39;:&#39;{1}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;server&#39;</span><span class="p">],</span>
                                                                              <span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;sync_port&#39;</span><span class="p">]))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__disconnect</span><span class="p">(</span><span class="n">release_ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>


</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.acquire"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.acquire">[docs]</a>    <span class="k">def</span> <span class="nf">acquire</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Acquires ports for executing commands</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute the command</span>
<span class="sd">                force : bool</span>
<span class="sd">                    force acquire the ports</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># by default use all ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Force acquiring ports {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Acquiring ports {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acquire</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="c"># cleanup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__release</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.release"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.release">[docs]</a>    <span class="k">def</span> <span class="nf">release</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Release ports</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute the command</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Releasing ports {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__release</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.ping"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.ping">[docs]</a>    <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Pings the server</span>

<span class="sd">            :parameters:</span>
<span class="sd">                None</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span> <span class="s">&quot;Pinging the server on &#39;{0}&#39; port &#39;{1}&#39;: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;server&#39;</span><span class="p">],</span>
                                                                               <span class="bp">self</span><span class="o">.</span><span class="n">connection_info</span><span class="p">[</span><span class="s">&#39;sync_port&#39;</span><span class="p">]))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transmit</span><span class="p">(</span><span class="s">&quot;ping&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.get_active_pgids"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.get_active_pgids">[docs]</a>    <span class="k">def</span> <span class="nf">get_active_pgids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Get active group ids</span>

<span class="sd">            :parameters:</span>
<span class="sd">                None</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span> <span class="s">&quot;Getting active packet group ids&quot;</span><span class="p">)</span>

        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transmit</span><span class="p">(</span><span class="s">&quot;get_active_pgids&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.reset"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            force acquire ports, stop the traffic, remove all streams and clear stats</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                   ports to execute the command</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_streams</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.remove_all_streams"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.remove_all_streams">[docs]</a>    <span class="k">def</span> <span class="nf">remove_all_streams</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            remove all streams from port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute the command</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Removing all streams from port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__remove_all_streams</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

 </div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.add_streams"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.add_streams">[docs]</a>    <span class="k">def</span> <span class="nf">add_streams</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">streams</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            add a list of streams to port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute the command</span>
<span class="sd">                streams: list</span>
<span class="sd">                    streams to attach (or profile)</span>

<span class="sd">            :returns:</span>
<span class="sd">                list of stream IDs in order of the stream list</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">streams</span><span class="p">,</span> <span class="n">STLProfile</span><span class="p">):</span>
            <span class="n">streams</span> <span class="o">=</span> <span class="n">streams</span><span class="o">.</span><span class="n">get_streams</span><span class="p">()</span>

        <span class="c"># transform single stream</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">streams</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">streams</span> <span class="o">=</span> <span class="p">[</span><span class="n">streams</span><span class="p">]</span>

        <span class="c"># check streams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">STLStream</span><span class="p">)</span> <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">streams</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;streams&#39;</span><span class="p">,</span> <span class="n">streams</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Attaching {0} streams to port(s) {1}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">streams</span><span class="p">),</span> <span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__add_streams</span><span class="p">(</span><span class="n">streams</span><span class="p">,</span> <span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="c"># return the stream IDs</span>
        <span class="k">return</span> <span class="n">rc</span><span class="o">.</span><span class="n">data</span><span class="p">()</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.remove_streams"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.remove_streams">[docs]</a>    <span class="k">def</span> <span class="nf">remove_streams</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id_list</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            remove a list of streams from ports</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute the command</span>
<span class="sd">                stream_id_list: list</span>
<span class="sd">                    stream id list to remove</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># transform single stream</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_id_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">stream_id_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">stream_id_list</span><span class="p">]</span>

        <span class="c"># check streams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="nb">long</span><span class="p">)</span> <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="n">stream_id_list</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;stream_id_list&#39;</span><span class="p">,</span> <span class="n">stream_id_list</span><span class="p">)</span>

        <span class="c"># remove streams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Removing {0} streams from port(s) {1}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stream_id_list</span><span class="p">),</span> <span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__remove_streams</span><span class="p">(</span><span class="n">stream_id_list</span><span class="p">,</span> <span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>


   </div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.start"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
               <span class="n">mult</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="p">,</span>
               <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
               <span class="n">duration</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">total</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            start traffic on port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">                mult : str</span>
<span class="sd">                    multiplier in a form of pps, bps, or line util in %</span>
<span class="sd">                    examples: &quot;5kpps&quot;, &quot;10gbps&quot;, &quot;85%&quot;, &quot;32mbps&quot;</span>

<span class="sd">                force : bool</span>
<span class="sd">                    imply stopping the port of active and also</span>
<span class="sd">                    forces a profile that exceeds the L1 BW</span>

<span class="sd">                duration : int</span>
<span class="sd">                    limit the run for time in seconds</span>
<span class="sd">                    -1 means unlimited</span>

<span class="sd">                total : bool</span>
<span class="sd">                    should the B/W be divided by the ports</span>
<span class="sd">                    or duplicated for each</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


        <span class="c"># verify multiplier</span>
        <span class="n">mult_obj</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">decode_multiplier</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span>
                                                  <span class="n">allow_update</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">divide_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span> <span class="k">if</span> <span class="n">total</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mult_obj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;mult&#39;</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span>

        <span class="c"># some type checkings</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">force</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;force&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;total&#39;</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>


        <span class="c"># verify ports are stopped or force stop them</span>
        <span class="n">active_ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">active_ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="s">&quot;Port(s) {0} are active - please stop them or specify &#39;force&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">active_ports</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">active_ports</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>


        <span class="c"># start traffic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Starting traffic on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">(</span><span class="n">mult_obj</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>



    </div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.stop"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            stop port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute the command</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Stopping traffic on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stop</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        </div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.update"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            update traffic on port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">                mult : str</span>
<span class="sd">                    multiplier in a form of pps, bps, or line util in %</span>
<span class="sd">                    and also with +/-</span>
<span class="sd">                    examples: &quot;5kpps+&quot;, &quot;10gbps-&quot;, &quot;85%&quot;, &quot;32mbps&quot;, &quot;20%+&quot;</span>

<span class="sd">                force : bool</span>
<span class="sd">                    forces a profile that exceeds the L1 BW</span>

<span class="sd">                total : bool</span>
<span class="sd">                    should the B/W be divided by the ports</span>
<span class="sd">                    or duplicated for each</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


        <span class="c"># verify multiplier</span>
        <span class="n">mult_obj</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">decode_multiplier</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span>
                                                  <span class="n">allow_update</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                  <span class="n">divide_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span> <span class="k">if</span> <span class="n">total</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mult_obj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;mult&#39;</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span>

        <span class="c"># verify total</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">total</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;total&#39;</span><span class="p">,</span> <span class="n">total</span><span class="p">)</span>


        <span class="c"># call low level functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Updating traffic on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__update</span><span class="p">(</span><span class="n">mult_obj</span><span class="p">,</span> <span class="n">ports</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>


</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.pause"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.pause">[docs]</a>    <span class="k">def</span> <span class="nf">pause</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            pause traffic on port(s). works only for ports that are active and all streams are in cont mode </span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transmitting_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Pausing traffic on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__pause</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.resume"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.resume">[docs]</a>    <span class="k">def</span> <span class="nf">resume</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            resume traffic on port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_paused_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Resume traffic on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__resume</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.validate"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="s">&quot;-1&quot;</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            validate port(s) configuration</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">             mult : str</span>
<span class="sd">                    multiplier in a form of pps, bps, or line util in %</span>
<span class="sd">                    examples: &quot;5kpps&quot;, &quot;10gbps&quot;, &quot;85%&quot;, &quot;32mbps&quot;</span>

<span class="sd">            duration : int</span>
<span class="sd">                    limit the run for time in seconds</span>
<span class="sd">                    -1 means unlimited</span>

<span class="sd">            total : bool</span>
<span class="sd">                    should the B/W be divided by the ports</span>
<span class="sd">                    or duplicated for each</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


        <span class="c"># verify multiplier</span>
        <span class="n">mult_obj</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">decode_multiplier</span><span class="p">(</span><span class="n">mult</span><span class="p">,</span>
                                                  <span class="n">allow_update</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                  <span class="n">divide_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span> <span class="k">if</span> <span class="n">total</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mult_obj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;mult&#39;</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;duration&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Validating streams on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__validate</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>


        <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">print_profile</span><span class="p">(</span><span class="n">mult_obj</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.clear_stats"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.clear_stats">[docs]</a>    <span class="k">def</span> <span class="nf">clear_stats</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">clear_global</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">clear_flow_stats</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            clear stats on port(s)</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">                clear_global : bool</span>
<span class="sd">                    clear the global stats</span>

<span class="sd">                clear_flow_stats : bool </span>
<span class="sd">                    clear the flow stats</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLError`</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># verify clear global</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">clear_global</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLArgumentError</span><span class="p">(</span><span class="s">&#39;clear_global&#39;</span><span class="p">,</span> <span class="n">clear_global</span><span class="p">)</span>


        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__clear_stats</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">clear_global</span><span class="p">,</span> <span class="n">clear_flow_stats</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>


  </div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.is_traffic_active"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.is_traffic_active">[docs]</a>    <span class="k">def</span> <span class="nf">is_traffic_active</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            retrun if  specify port(s) has traffic </span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>


<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLTimeoutError` - in case timeout has expired</span>
<span class="sd">                + :exe:&#39;STLError&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.wait_on_traffic"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.wait_on_traffic">[docs]</a>    <span class="k">def</span> <span class="nf">wait_on_traffic</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">60</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            block until specify port(s) traffic has ended</span>

<span class="sd">            :parameters:</span>
<span class="sd">                ports : list</span>
<span class="sd">                    ports to execute command</span>

<span class="sd">                timeout : int</span>
<span class="sd">                    timeout in seconds</span>

<span class="sd">            :raises:</span>
<span class="sd">                + :exc:`STLTimeoutError` - in case timeout has expired</span>
<span class="sd">                + :exe:&#39;STLError&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>


        <span class="n">expr</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">timeout</span>

        <span class="c"># wait while any of the required ports are active</span>
        <span class="k">while</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ports</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">expr</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">STLTimeoutError</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>

</div>
    <span class="nd">@__api_check</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<div class="viewcode-block" id="STLClient.set_port_attr"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.set_port_attr">[docs]</a>    <span class="k">def</span> <span class="nf">set_port_attr</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ports</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">promiscuous</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            set port(s) attributes</span>

<span class="sd">            :parameters:</span>
<span class="sd">                promiscuous - set this to True or False</span>

<span class="sd">            :raises:</span>
<span class="sd">                None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ports</span> <span class="o">=</span> <span class="n">ports</span> <span class="k">if</span> <span class="n">ports</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_acquired_ports</span><span class="p">()</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_port_list</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># check arguments</span>
        <span class="n">validate_type</span><span class="p">(</span><span class="s">&#39;promiscuous&#39;</span><span class="p">,</span> <span class="n">promiscuous</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">))</span>

        <span class="c"># build attributes</span>
        <span class="n">attr_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">promiscuous</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">attr_dict</span><span class="p">[</span><span class="s">&#39;promiscuous&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;enabled&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">promiscuous</span><span class="p">)}</span>
        
        <span class="c"># no attributes to set</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attr_dict</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">pre_cmd</span><span class="p">(</span><span class="s">&quot;Applying attributes on port(s) {0}:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ports</span><span class="p">))</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_port_attr</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">attr_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">post_cmd</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">STLError</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="STLClient.clear_events"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.clear_events">[docs]</a>    <span class="k">def</span> <span class="nf">clear_events</span> <span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            clear all events</span>

<span class="sd">            :parameters:</span>
<span class="sd">                None</span>

<span class="sd">            :raises:</span>
<span class="sd">                None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_handler</span><span class="o">.</span><span class="n">clear_events</span><span class="p">()</span>


    <span class="c">############################   Line       #############################</span>
    <span class="c">############################   Commands   #############################</span>
    <span class="c">############################              #############################</span>

    <span class="c"># console decorator</span></div>
    <span class="k">def</span> <span class="nf">__console</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">time1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">rc</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">STLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Log:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">format_text</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">brief</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="c"># if got true - print time</span>
            <span class="k">if</span> <span class="n">rc</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">time1</span>
                <span class="n">client</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_time</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">wrap</span>


    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.connect_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.connect_line">[docs]</a>    <span class="k">def</span> <span class="nf">connect_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Connects to the TRex server&#39;&#39;&#39;</span>
        <span class="c"># define a parser</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;connect&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">connect_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">FORCE</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># call the API</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">force</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">)</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
    <span class="nd">@__console</span>
    <span class="k">def</span> <span class="nf">disconnect_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        


    <span class="nd">@__console</span>
    <span class="k">def</span> <span class="nf">reset_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>


    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.start_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.start_line">[docs]</a>    <span class="k">def</span> <span class="nf">start_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Start selected traffic in specified ports on TRex\n&#39;&#39;&#39;</span>
        <span class="c"># define a parser</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;start&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">start_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">TOTAL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">FORCE</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">FILE_PATH</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">MULTIPLIER_STRICT</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">DRY_RUN</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>


        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>


        <span class="n">active_ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">active_ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Port(s) {0} are active - please stop them or add &#39;--force&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">active_ports</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">active_ports</span><span class="p">)</span>


        <span class="c"># remove all streams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_streams</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># pack the profile</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">STLProfile</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">STLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error while loading profile &#39;{0}&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">brief</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">return</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">add_streams</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">get_streams</span><span class="p">(),</span> <span class="n">ports</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">dry</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">mult</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span>
                       <span class="n">opts</span><span class="o">.</span><span class="n">mult</span><span class="p">,</span>
                       <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                       <span class="n">opts</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                       <span class="n">opts</span><span class="o">.</span><span class="n">total</span><span class="p">)</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>


</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.stop_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.stop_line">[docs]</a>    <span class="k">def</span> <span class="nf">stop_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Stop active traffic in specified ports on TRex\n&#39;&#39;&#39;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;stop&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">stop_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># find the relevant ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;No active traffic on provided ports</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.update_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.update_line">[docs]</a>    <span class="k">def</span> <span class="nf">update_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Update port(s) speed currently active\n&#39;&#39;&#39;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;update&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">update_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">MULTIPLIER</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">TOTAL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">FORCE</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

         <span class="c"># find the relevant ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;No ports in valid state to update</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ports</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">mult</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">)</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.pause_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.pause_line">[docs]</a>    <span class="k">def</span> <span class="nf">pause_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Pause active traffic in specified ports on TRex\n&#39;&#39;&#39;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;pause&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">pause_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># find the relevant ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transmitting_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;No ports in valid state to pause</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pause</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.resume_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.resume_line">[docs]</a>    <span class="k">def</span> <span class="nf">resume_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Resume active traffic in specified ports on TRex\n&#39;&#39;&#39;</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;resume&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">resume_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># find the relevant ports</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_paused_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ports</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;No ports in valid state to resume</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">ports</span><span class="p">)</span>

        <span class="c"># true means print time</span>
        <span class="k">return</span> <span class="bp">True</span>

   </div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.clear_stats_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.clear_stats_line">[docs]</a>    <span class="k">def</span> <span class="nf">clear_stats_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Clear cached local statistics\n&#39;&#39;&#39;</span>
        <span class="c"># define a parser</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;clear&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">clear_stats_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>



</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.show_stats_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.show_stats_line">[docs]</a>    <span class="k">def</span> <span class="nf">show_stats_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch statistics from TRex server by port\n&#39;&#39;&#39;</span>
        <span class="c"># define a parser</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;stats&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">show_stats_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">STATS_MASK</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># determine stats mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_mask_keys</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">__filter_namespace_args</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">ALL_STATS_OPTS</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mask</span><span class="p">:</span>
            <span class="c"># set to show all stats if no filter was given</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">ALL_STATS_OPTS</span>

        <span class="n">stats_opts</span> <span class="o">=</span> <span class="n">trex_stl_stats</span><span class="o">.</span><span class="n">ALL_STATS_OPTS</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_formatted_stats</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>


        <span class="c"># print stats to screen</span>
        <span class="k">for</span> <span class="n">stat_type</span><span class="p">,</span> <span class="n">stat_data</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">text_tables</span><span class="o">.</span><span class="n">print_table_with_header</span><span class="p">(</span><span class="n">stat_data</span><span class="o">.</span><span class="n">text_table</span><span class="p">,</span> <span class="n">stat_type</span><span class="p">)</span>

</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.show_streams_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.show_streams_line">[docs]</a>    <span class="k">def</span> <span class="nf">show_streams_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fetch streams statistics from TRex server by port\n&#39;&#39;&#39;</span>
        <span class="c"># define a parser</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;streams&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">show_streams_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">STREAMS_MASK</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">streams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_streams</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">streams</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">streams</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="s">&quot;No streams found with desired filter.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;bold&quot;</span><span class="p">,</span> <span class="s">&quot;magenta&quot;</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c"># print stats to screen</span>
            <span class="k">for</span> <span class="n">stream_hdr</span><span class="p">,</span> <span class="n">port_streams_data</span> <span class="ow">in</span> <span class="n">streams</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">text_tables</span><span class="o">.</span><span class="n">print_table_with_header</span><span class="p">(</span><span class="n">port_streams_data</span><span class="o">.</span><span class="n">text_table</span><span class="p">,</span>
                                                    <span class="n">header</span><span class="o">=</span> <span class="n">stream_hdr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span><span class="p">,</span>
                                                    <span class="n">untouched_header</span><span class="o">=</span> <span class="n">stream_hdr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>



</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.validate_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.validate_line">[docs]</a>    <span class="k">def</span> <span class="nf">validate_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;validates port(s) stream configuration\n&#39;&#39;&#39;</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;validate&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">validate_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>



 </div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.push_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.push_line">[docs]</a>    <span class="k">def</span> <span class="nf">push_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Push a PCAP file &#39;&#39;&#39;</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;push&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">push_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">FILE_PATH</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">COUNT</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">DURATION</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">IPG</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">SPEEDUP</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">FORCE</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">active_ports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_ports</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">active_ports</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Port(s) {0} are active - please stop them or add &#39;--force&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">active_ports</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">format_text</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&#39;bold&#39;</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">active_ports</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># pcap injection removes all previous streams from the ports</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_all_streams</span><span class="p">(</span><span class="n">ports</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>
            
            <span class="n">profile</span> <span class="o">=</span> <span class="n">STLProfile</span><span class="o">.</span><span class="n">load_pcap</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">file</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="n">opts</span><span class="o">.</span><span class="n">ipg_usec</span><span class="p">,</span>
                                           <span class="n">opts</span><span class="o">.</span><span class="n">speedup</span><span class="p">,</span>
                                           <span class="n">opts</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>

            <span class="n">id_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_streams</span><span class="p">(</span><span class="n">profile</span><span class="o">.</span><span class="n">get_streams</span><span class="p">(),</span> <span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">ports</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">force</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">STLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">stl</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">brief</span><span class="p">())</span>
            <span class="k">return</span>

        <span class="k">return</span> <span class="bp">True</span>


</div>
    <span class="nd">@__console</span>
<div class="viewcode-block" id="STLClient.set_port_attr_line"><a class="viewcode-back" href="../../api/client_code.html#trex_stl_lib.trex_stl_client.STLClient.set_port_attr_line">[docs]</a>    <span class="k">def</span> <span class="nf">set_port_attr_line</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets port attributes &#39;&#39;&#39;</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">parsing_opts</span><span class="o">.</span><span class="n">gen_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="s">&quot;port&quot;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">set_port_attr_line</span><span class="o">.</span><span class="n">__doc__</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PORT_LIST_WITH_ALL</span><span class="p">,</span>
                                         <span class="n">parsing_opts</span><span class="o">.</span><span class="n">PROMISCUOUS_SWITCH</span><span class="p">)</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">opts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_port_attr</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">ports</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">prom</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">STLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">stl</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">brief</span><span class="p">())</span>
            <span class="k">return</span>

    </div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TRex Stateless Python API 1.7.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Cisco Systems Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>